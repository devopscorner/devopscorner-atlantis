#!/bin/bash
# install-atlantis-deploy

set -euo pipefail

echo "ğŸš€ Installing atlantis-deploy system-wide..."

# Check if running as root or with sudo
if [ "$EUID" -ne 0 ]; then
    echo "âŒ Please run this script with sudo or as root"
    exit 1
fi

# Source and destination paths
SOURCE_SCRIPT="./scripts/atlantis-deploy.sh"
DEST_PATH="/usr/local/bin/atlantis-deploy"

# Check if source script exists
if [ ! -f "$SOURCE_SCRIPT" ]; then
    echo "âŒ Source script not found: $SOURCE_SCRIPT"
    exit 1
fi

# Copy script to system location
echo "ğŸ“‹ Copying script to $DEST_PATH..."
cp "$SOURCE_SCRIPT" "$DEST_PATH"

# Make it executable
echo "ğŸ”§ Making script executable..."
chmod +x "$DEST_PATH"

# Verify installation
if [ -x "$DEST_PATH" ]; then
    echo "âœ… atlantis-deploy installed successfully!"
    echo "ğŸ“ Location: $DEST_PATH"
    echo "ğŸ“– Usage: atlantis-deploy <environment> <workspace> [plan|apply]"
    echo "ğŸ’¡ Example: atlantis-deploy dev01 default plan"

    # Show version
    echo "ğŸ” Testing installation..."
    "$DEST_PATH" --version
else
    echo "âŒ Installation failed!"
    exit 1
fi